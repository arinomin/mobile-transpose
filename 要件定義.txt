# Webアプリケーション「mobile-transpose」要件定義書

## 1. 概要

本ドキュメントは、Webアプリケーション「mobile-transpose」の機能要件および非機能要件を定義するものである。

本アプリケーションは、ループステーション「BOSS RC-505mk2」に搭載されている「TRANSPOSE」エフェクトを、スマートフォンやPCのブラウザ上で高機能に再現するツールである。ループステーションが手元にない状況でも、Transposeエフェクトを用いたメロディのアイデア作成を支援し、特にループパフォーマー（ルーパー）の創作活動における利便性を向上させることを目的とする。

---

## 2. 開発方針

- **フロントエンド完結**: HTML, CSS, JavaScriptのみで構成し、サーバーサイドの実装は行わない。
- **アカウント機能不要**: ユーザー登録やログイン機能を設けず、誰でもすぐに利用できる手軽さを最優先する。
- **付加価値の提供**: 単なるエフェクトの再現に留まらず、本家デバイスでは手のかかる**音階の計算を自動化・可視化**することで、直感的な作曲を支援するという独自の付加価値を提供する。

---

## 3. 機能要件

### 3.1. メイン画面

- **シーケンサーグリッド**
    - 16個のステップ（4x4のグリッド）を表示する。
    - 各ステップには、設定された**Transpose値（-12〜+12）**と、ベース音から計算された**絶対音名（例: G4）**の両方を常時表示する。
    - ベース音を変更すると、全ステップの絶対音名がリアルタイムで更新される。
    - ステップをタップすると、そのステップを編集するためのモーダルが開く。

- **再生コントロール**
    - **再生ボタン**: シーケンスを1周だけ再生する。
    - **ループ再生ボタン**: シーケンスを繰り返し再生する。
    - **停止ボタン**: 再生を停止する。再生中のステップのハイライトも即座に解除される。

- **グローバル設定**
    - **BPM**: 40〜280の範囲でBPM（Beats Per Minute）を数値入力で設定できる。
    - **ベース音**: 基準となる音程を**音名（C〜B）**と**オクターブ（1〜7）**に分かれたドロップダウンメニューで設定できる。

### 3.2. ステップ編集モーダル

- **カスタムTransposeセレクター**
    - -12から+12までの値を設定するための、**目盛り付きカスタムUI**を提供する。
    - UIは**タップ**および**ドラッグ（スワイプ）**の両方の操作に対応し、直感的な値の選択を可能にする。
    - 主要な目盛り（-12, -7, 0, +7, +12）は、他の目盛りより視覚的に分かりやすく表示する。
    - ダークモード環境でも視認性が高い、ハイコントラストなデザインを採用する。

- **リアルタイム情報表示**
    - 選択中の**Transpose値**（例: `+7`）
    - 対応する**音程名**（例: `Perfect 5th Up`）
    - ベース音と合成された**最終的な絶対音名**（例: `G4`）
    - 上記3つの情報を、セレクター操作中にリアルタイムで更新・表示する。

- **アクションボタン**
    - **試聴ボタン**: 現在モーダルで設定している音をワンショットで再生する。
    - **リセットボタン**: Transpose値を`0`にリセットする。
    - **完了ボタン**: 設定を保存し、モーダルを閉じる。

### 3.3. 音源

- **Web Audio API** を使用し、ブラウザ上で基本的な波形（サイン波など）の音源を生成する。
- ベース音のMIDIノートナンバーとTranspose値を加算し、正確な周波数を算出して再生する。

---

## 4. 非機能要件

- **対応ブラウザ**: 主要なモダンブラウザの最新版（Google Chrome, Safari, Firefox）に対応する。
- **レスポンシブデザイン**: スマートフォンでの利用をメインターゲットとしつつ、PCやタブレットでもレイアウトが崩れず快適に操作できるUIを提供する。
- **パフォーマンス**: アプリケーションの読み込みが速く、再生やUI操作に対する応答性が高いこと。特に再生中の描画遅延が発生しないように配慮する。